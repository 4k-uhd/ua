<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>모바일 페이지</title>
<script src="https://cdn.jsdelivr.net/npm/ua-parser-js@2.0.2/dist/ua-parser.pack.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.8.2/dist/axios.min.js"></script>
<style>
/* 기본 스타일 초기화 */
body, h1, h2, h3, p, ul, li {
margin: 0;
padding: 0;
}
body {
        font-family: sans-serif;
        line-height: 1.6;
        background-color: #f4f4f4;
        color: #333;
    }

    /* 헤더 스타일 */
    header {
        background-color: #333;
        color: #fff;
        padding: 10px;
        text-align: center;
    }

    /* 내비게이션 스타일 */
    nav ul {
        background-color: #ddd;
        list-style: none;
        padding: 10px;
        text-align: center;
    }

    nav li {
        display: inline;
        margin: 0 10px;
    }

    nav a {
        text-decoration: none;
        color: #333;
    }

    /* 메인 콘텐츠 스타일 */
    main {
        padding: 20px;
    }

    section {
        margin-bottom: 20px;
    }

    /* 푸터 스타일 */
    footer {
        background-color: #333;
        color: #fff;
        text-align: center;
        padding: 10px;
        position: fixed; /* 화면 하단에 고정 */
        bottom: 0;        /* 화면 하단에 위치 */
        width: 100%;       /* 전체 너비 */
    }

    p {
            word-wrap: break-word; /* 긴 단어 줄바꿈 */
            overflow-wrap: break-word; /* 긴 URL 줄바꿈 (최신 브라우저) */
    }

    /* 미디어 쿼리: 작은 화면에 대한 스타일 */
    @media (max-width: 600px) {
        nav li {
            display: block;
            margin: 5px 0;
        }
    }
</style>

</head>
<body>
<header>
<h1>모바일 페이지</h1>
</header>
<nav>
    <ul>
        <li><a href="#">홈</a></li>
        <li><a href="#">제품</a></li>
        <li><a href="#">서비스</a></li>
        <li><a href="#">문의</a></li>
    </ul>
</nav>

<main>
    <section>
        <h2>단갈기정보</h2>
        <p id="info"></p>
    </section>
    <section>
        <h2>전송결과</h2>
        <p id="result"></p>
    </section>
    
</main>

<footer>
    <p>© 2024 모바일 데이터 수집</p>
</footer>
<script>
    async function collectDeviceInfo() {
      const data = {
        userAgent: navigator.userAgent,
        viewport: {
          width: window.innerWidth,
          height: window.innerHeight
        },
        deviceScaleFactor: window.devicePixelRatio,
        hasTouch: 'ontouchstart' in window || navigator.maxTouchPoints > 0,
        env: {},
        userAgentData: {}
      };

      // User Agent 파싱
      const parser = new UAParser();
      const uaResult = parser.getResult();

      // 고급 정보 수집
      let highEntropyData = {};
      if (navigator.userAgentData?.getHighEntropyValues) {
        try {
          highEntropyData = await navigator.userAgentData.getHighEntropyValues([
            'platformVersion',
            'fullVersionList'
          ]);
        } catch (error) {
          console.error('High entropy data error:', error);
        }
      }

      // 환경 정보 구성
      data.env = {
        os: uaResult.os.name || navigator.platform,
        br_ln: navigator.language,
        br_sr: `${window.innerWidth}x${window.innerHeight}`,
        device_sr: `${Math.round(screen.width * window.devicePixelRatio)}x${Math.round(screen.height * window.devicePixelRatio)}`,
        platform_type: 'web',
        device_pr: window.devicePixelRatio,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        ch_pltf: navigator.userAgentData?.platform || '',
        ch_mob: navigator.userAgentData?.mobile || false,
        ch_mdl: uaResult.device.model || '',
        ch_arch: '',
        ch_pltfv: highEntropyData.platformVersion || '',
        ch_fvls: highEntropyData.fullVersionList || []
      };

      // UserAgent 데이터
      data.userAgentData = {
        brands: navigator.userAgentData?.brands || [],
        mobile: navigator.userAgentData?.mobile || false,
        platform: navigator.userAgentData?.platform || ''
      };
      var paragraph = document.getElementById("info");
      var text = document.createTextNode(JSON.stringify(data, null, 2));

      paragraph.appendChild(text);

      axios.post('https://69d3-211-188-56-235.ngrok-free.app', { // 서버 엔드포인트 URL
        info: JSON.stringify(data) // info 값을 객체에 담아 보냄
      })
      .then(function (response) {
        console.log("성공:", response.data);
        document.getElementById("result").textContent = "성공: " + JSON.stringify(response.data);
      })
      .catch(function (error) {
        console.error("오류:", error);
        document.getElementById("result").textContent = "오류: " + error;
      });
        
     
    }

    // 페이지 로드 시 정보 수집 시작
    collectDeviceInfo();
  </script>

</body>
</html>
